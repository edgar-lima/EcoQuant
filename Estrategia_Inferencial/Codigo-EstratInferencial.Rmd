---
title: "Estratégias Inferenciais"
author: "Edgar Luiz de Lima"
date: "11/03/2022"
output:
  pdf_document: default
  html_document: default
---

# Dados
  O conjunto de dados que iremos utilizar foi retirado de um conjuto de dados muito maior de Mazerolle & Desrochers (2005).
  
  Ele apresenta as seguintes variáveis:
  
  1. Shade: variável binária indicando se o indivíduo foi coletado na sombra(1= sim, 0= não).
  2. Cloud: cobertura de núvem expressa em porcentagem.
  3. Airtemp: temperatura do ar em graus celcius.
  4. Mass_lost: perda de massa corporal em gramas.

1. Aqui iremos definir o diretório, carregar os pacotes e o banco de dados.
```{r}
library(MuMIn)
library(openxlsx)
library(ggplot2)
library(ggpubr)
library(effectsize)
dados<- read.xlsx("Dados.xlsx")
```

1.2. Vamos visualizar as 10 primeiras linhas do conjunto de dados.
```{r}
head(dados, 10)
```

1.3. Agora precisamos checar como o formato em que o R leu os dados, para saber se os dados estão no formato correto.
```{r}
str(dados)
```
Podemos ver que a variável Shade está sendo interpretada como variável numérica, mas na verdade ela deve ser interpretatada como uma variável categórica.

Então vamos converter ela em fator, e depois checar se ela realmente foi interpretada como fator.
```{r}
dados$Shade<- as.factor(dados$Shade)
str(dados)
```
Agora o R está interpretando ela como fator, e está nos dizendo que ela possui os níveis 0 e 1, que significam não estar na sombra e estar na sombra respectavamente.

# Testando as nossas hipóteses

  Antes de testar as nossas hipoteses precisamos entender primeiro como descrevemos o nosso modelo estatístico no R. Para isso utilizamos o a função lm() que significar linear model, e especificamos o noss modelo da seguinte maneira.
  
               lm(y~x, data) 

  onde:
  1. y= é a variável resposta, nesse caso Mass_lost;
  2. x= é a variável preditora, no nosso caso teremos três variáveis preditoras;
  3. data= é o conjunto de dados que as minhas variáveis fazem parte.
  4. til(~)= significa em função de, ou seha, minha variável resposta em função das variáveis preditoras.



## 1. Teste de significancia da hipótese nula (NHST)

1.1 Primeiramente, temos que especificar o nosso modelo.
  Então,especificaremos o nosso modelo da seguinte maneira, Mass_lost em função de Airtemp,Cloud e Shade. E indicamos que as variáveis está dento do conjunto de dados chamada dados.
```{r}
nhst<- lm(Mass_lost~Airtemp+Cloud+Shade, data = dados)
nhst
```
  Pronto, o modelo já foi ajustado, podemos ler o ajuste do modelo da seguinte forma:
  
  1. Intercep= média da Mass_loss para os indivíduos que não está na sombra.
  2. Airtemp= é o tamanho de efeito(a1) da Airtemp sobre a Mass_loss (aqui o tamanho de efeito é representado pelo coeficiente de inclinação da reta).
  3. Clound= é o tamanho de efeito(a1) da Cloud sobre a Mass_loss.
  4. Shade1= é o tamanho de efeito da variável Shade sobre o Mass_loss, ou seja, é a diferença entre as médias de Mass_loss no tratamento 1 e 0.
  
  Podemos obter o valor da média de Mass_loss no tratamento shade1 subtraindo do intercept o valor do tamanho de efeito.
```{r}
coefi<- nhst$coefficients
coefi[1]-abs(coefi[4])
```
  Podemos observar então que o valor da média de Mass_loss em Shade1 que são aqueles indivíduos coletados em ambiente sombreado é igual a 1.631833

  1.2. Agora vamos verificar o valor de p para saber se iremos rejeitar a hipótese nula.
```{r}
summary(nhst)
```
Nesse caso então, rejeitamos a hipótese nula e aceitamos a hipótese alternativa, e de acordo com os nossas resultados, há diferença na perda de massa corporal entre indivíduos que estão na sombra e indivíduos que não estão na sombra. Sendo que indivíduos que não estão na sombra perdem 0.789 gramas a mais que os indivídos que estão na sombra.

## 2. Intervalo de confiança
```{r}
intconf<- lm(Mass_lost~Airtemp+Cloud+Shade, data = dados)
ic<-confint.lm(object = intconf)
tam<- coef(intconf)
esnat<- data.frame(c("Air Temp","Cloud","Shade" ),tam[c(2,3,4)],ic[c(2,3,4),1],ic[c(2,3,4),2])
colnames(esnat)<- c("Var","Tam", "ICmin","ICmax")
esnat[,1]<-as.factor(esnat[,1])
```
Aqui a melhor maneira de se conferir os resultados é a partir da visualização gráfica, então vamos construir um gráfico para visualizarmos os resultados.

Mas uma coisa importante de se considerar, é que cada variável está em uma unidade de medida diferente, se vamos analisar os efeitos separadamente, sem fazer comparação entre variáveis, podemos manter os tamanhos de efeito na escala original das variáveis, se formos fazer uma comparação do tamanho de efeito entre as variáveis precisamos padronizar os tamanhos de efeito. Isso pode ser feito de duas formas, padronizando os tamanhos de efeito depois que o modelo foi ajustado, ou padronizar as variáveis (e.g. Z-Score) antes e depois ajustar o modelo com as variáveis padronizadas.

Aqui iremos fazer a padronização com o modelo já ajustado, a transformação que será aplicada é a do Z-Score.
```{r}
efpad<- effectsize(intconf)

efpad2<- data.frame(c("Air Temp","Cloud","Shade" ),
                    efpad[c(2,3,4),2], efpad$CI_low[-1],efpad$CI_high[-1] )
colnames(efpad2)<- c("Var","Tam", "ICmin","ICmax")
efpad2[,1]<-as.factor(efpad2[,1])

```

Agora vamos criar os gráficos para interpretar os resultados.

Gráfico para o tamanho de efeito na escala originao da variável.
```{r}
orig<-ggplot(data= esnat, aes( Tam,Var,xmin= ICmin, xmax= ICmax))+
  geom_errorbarh(alpha=2,size= 1.5, height= 0.8) +
  geom_point(shape= 15, size=5)+
  scale_x_continuous(breaks= seq(-1.5,0.3,0.2),
                     limits = c(-1.5,0.3))+
  geom_vline(xintercept = 0.0, linetype=2, size = 1.5)+
  ylab("Variáveis")+
  xlab("Tamanho de efeito (Z-Score)")+
  labs(title= "Tamanho de efeito escala original")+
  theme_bw()+
  theme(panel.grid = element_blank(), axis.title = element_text(size= 16, colour = "black"), 
        axis.title.y = element_blank(),axis.text = element_text(size = 14, colour = "black"), axis.text.y =element_blank(),
         plot.title = element_text(size = 15, hjust =.5))
```

Gráfico para o tamanho de efeito padronizado.
```{r}
tampad<- ggplot(data= efpad2, aes( Tam,Var,xmin= ICmin, xmax= ICmax))+
  geom_errorbarh(alpha=2,size= 1.5, height= 0.8) +
  geom_point(shape= 15, size=5)+
  scale_x_continuous(breaks= seq(-0.9,0.3,0.2),
                     limits = c(-0.9,0.3))+
  geom_vline(xintercept = 0.0, linetype=2, size = 1.5)+
  ylab("Variáveis")+
  xlab("Tamanho de efeito (Z-Score)")+
  labs(title= "Tamanho de efeito padronizado")+
  theme_bw()+
  theme(panel.grid = element_blank(), axis.title = element_text(size= 16, colour = "black"), axis.text = element_text(size = 14, colour = "black"),
         plot.title = element_text(size = 15, hjust =.5))
  
```

Juntando os dois gráficos.
```{r}
ggarrange(tampad,orig,ncol = 2, nrow = 1)
```

Com base nos resultados na inferencia por intervalo de confiança, podemos concluir que aprenas a variável Shade possui efeito sob a perda de massa corporal. Sendo que indivíduos que estão na sombra perdem 0.789 a menos que indivíduos fora da sombra.

## 3. Selecao de modelos

Para a seleção de modelos iremos testar as seguintes hipóteses:
  1. (H1)A Perda de massa é afetada pela Airtemp, Clound e Shade;
  2. (H2) A preda de massa é afetada pela Airtemp e Cloud;
  3. (H3) A perda de massa é afetada pela Airtempo e Shade;
  4. (H4) A perda de massa é afetada pela Airtemp.
  
Ajustando os modelos correspondentes a cada uma das hipoteses.
```{r}
comp<-lm(Mass_lost~Airtemp+Cloud+Shade, data = dados)
tempcl<-lm(Mass_lost~Airtemp+Cloud, data = dados)
tempsh<-lm(Mass_lost~Airtemp+Shade, data = dados)
temp<- lm (Mass_lost~Airtemp+Shade, data = dados)

```

3.1. Seleção de modelos utilizando a Soma dos quadrados dos resíduos (SQR).
```{r}

sqr<-data.frame(sum(comp$residuals^2),sum(tempcl$residuals^2), sum(tempsh$residuals^2),sum(temp$residuals^2))
colnames(sqr)<- c("H1", "H2", "H3", "H4")
sqr
```

3.2. Seleção de modelos utilizando o R² ajustado.
```{r}
a<- summary(comp)$adj.r.squared
b<- summary(tempcl)$adj.r.squared
c<- summary(tempsh)$adj.r.squared
d<- summary(temp)$adj.r.squared

raju<-data.frame(a,b,c,d)
colnames(raju)<- c("H1", "H2", "H3", "H4")
raju
```

3.3. Seleção de modelos utilizando o AIC.
```{r}
contraste<- model.sel(comp,tempcl, tempsh, temp)
contraste<-contraste[,c(6:10)]
contraste[,c(1,3)]
```

Organizando os dados para fazer a análise gráfica.
```{r}
daic<- data.frame(row.names(contraste),contraste[,4])
colnames(daic)<- c("Hipoteses", "Delta_AIC")
```


Seleção de modelos utilizando o Delta AIC e fazendo a interpretação gráfica.
```{r}
ggplot(data= daic, aes( Hipoteses,Delta_AIC))+
  geom_point(shape= 15, size=5)+
  #scale_x_continuous(breaks= seq(-0.9,0.3,0.2),
                   #  limits = c(-0.9,0.3))+
  geom_hline(yintercept = 2, linetype=2, size = 1.5)+
  ylab(~Delta~AIC)+
  xlab("Hipóteses")+
  #labs(title= "Tamanho de efeito padronizado")+
  theme_bw()+
  theme(panel.grid = element_blank(), axis.title = element_text(size= 16, colour = "black"), axis.text = element_text(size = 14, colour = "black"),
         plot.title = element_text(size = 15, hjust =.5))
```
